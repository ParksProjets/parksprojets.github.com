// GSJS by Parks Projets
var Stats=function(){var e,t,n=0,r=0,i=Date.now(),s=i,o=i,u=0,a=1e3,f=0,l,c,h,p=[[16,16,48],[0,255,255]],d=0,v=1e3,m=0,g,y,b,w=[[16,48,16],[0,255,0]];e=document.createElement("div");e.style.cursor="pointer";e.style.width="80px";e.style.opacity="0.9";e.style.zIndex="10001";e.addEventListener("mousedown",function(e){e.preventDefault();n=(n+1)%2;n==0?(l.style.display="block",g.style.display="none"):(l.style.display="none",g.style.display="block")},!1);l=document.createElement("div");l.style.textAlign="left";l.style.lineHeight="1.2em";l.style.backgroundColor="rgb("+Math.floor(p[0][0]/2)+","+Math.floor(p[0][1]/2)+","+Math.floor(p[0][2]/2)+")";l.style.padding="0 0 3px 3px";e.appendChild(l);c=document.createElement("div");c.style.fontFamily="Helvetica, Arial, sans-serif";c.style.fontSize="9px";c.style.color="rgb("+p[1][0]+","+p[1][1]+","+p[1][2]+")";c.style.fontWeight="bold";c.innerHTML="FPS";l.appendChild(c);h=document.createElement("div");h.style.position="relative";h.style.width="74px";h.style.height="30px";h.style.backgroundColor="rgb("+p[1][0]+","+p[1][1]+","+p[1][2]+")";for(l.appendChild(h);h.children.length<74;)t=document.createElement("span"),t.style.width="1px",t.style.height="30px",t.style.cssFloat="left",t.style.backgroundColor="rgb("+p[0][0]+","+p[0][1]+","+p[0][2]+")",h.appendChild(t);g=document.createElement("div");g.style.textAlign="left";g.style.lineHeight="1.2em";g.style.backgroundColor="rgb("+Math.floor(w[0][0]/2)+","+Math.floor(w[0][1]/2)+","+Math.floor(w[0][2]/2)+")";g.style.padding="0 0 3px 3px";g.style.display="none";e.appendChild(g);y=document.createElement("div");y.style.fontFamily="Helvetica, Arial, sans-serif";y.style.fontSize="9px";y.style.color="rgb("+w[1][0]+","+w[1][1]+","+w[1][2]+")";y.style.fontWeight="bold";y.innerHTML="MS";g.appendChild(y);b=document.createElement("div");b.style.position="relative";b.style.width="74px";b.style.height="30px";b.style.backgroundColor="rgb("+w[1][0]+","+w[1][1]+","+w[1][2]+")";for(g.appendChild(b);b.children.length<74;)t=document.createElement("span"),t.style.width="1px",t.style.height=Math.random()*30+"px",t.style.cssFloat="left",t.style.backgroundColor="rgb("+w[0][0]+","+w[0][1]+","+w[0][2]+")",b.appendChild(t);return{domElement:e,update:function(){i=Date.now();d=i-s;v=Math.min(v,d);m=Math.max(m,d);y.textContent=d+" MS ("+v+"-"+m+")";var e=Math.min(30,30-d/200*30);b.appendChild(b.firstChild).style.height=e+"px";s=i;r++;if(i>o+1e3)u=Math.round(r*1e3/(i-o)),a=Math.min(a,u),f=Math.max(f,u),c.textContent=u+" FPS ("+a+"-"+f+")",e=Math.min(30,30-u/100*30),h.appendChild(h.firstChild).style.height=e+"px",o=i,r=0}}};var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return false}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob};THREE.OrbitControls=function(e,t){function E(){return 2*Math.PI/60/60*n.autoRotateSpeed}function S(){return Math.pow(.95,n.zoomSpeed)}function x(e){if(n.enabled===false){return}e.preventDefault();if(e.button===0){if(n.noRotate===true){return}b=y.ROTATE;i.set(e.clientX,e.clientY)}else if(e.button===1){if(n.noZoom===true){return}b=y.DOLLY;l.set(e.clientX,e.clientY)}else if(e.button===2){if(n.noPan===true){return}b=y.PAN;u.set(e.clientX,e.clientY)}n.domElement.addEventListener("mousemove",T,false);document.addEventListener("mouseup",N,false)}function T(e){if(n.enabled===false)return;e.preventDefault();var t=n.domElement===document?n.domElement.body:n.domElement;if(b===y.ROTATE){if(n.noRotate===true)return;s.set(e.clientX,e.clientY);o.subVectors(s,i);n.rotateLeft(2*Math.PI*o.x/t.clientWidth*n.rotateSpeed);n.rotateUp(2*Math.PI*o.y/t.clientHeight*n.rotateSpeed);i.copy(s)}else if(b===y.DOLLY){if(n.noZoom===true)return;c.set(e.clientX,e.clientY);h.subVectors(c,l);if(h.y>0){n.dollyIn()}else{n.dollyOut()}l.copy(c)}else if(b===y.PAN){if(n.noPan===true)return;a.set(e.clientX,e.clientY);f.subVectors(a,u);n.pan(f);u.copy(a)}n.update()}function N(){if(n.enabled===false)return;n.domElement.removeEventListener("mousemove",T,false);n.domElement.removeEventListener("mouseup",N,false);b=y.NONE}function C(e){if(n.enabled===false||n.noZoom===true)return;var t=0;if(e.wheelDelta){t=e.wheelDelta}else if(e.detail){t=-e.detail}if(t>0){n.dollyOut()}else{n.dollyIn()}}function k(e){if(n.enabled===false){return}if(n.noKeys===true){return}if(n.noPan===true){return}var t=false;switch(e.keyCode){case n.keys.UP:n.pan(new THREE.Vector2(0,n.keyPanSpeed));t=true;break;case n.keys.BOTTOM:n.pan(new THREE.Vector2(0,-n.keyPanSpeed));t=true;break;case n.keys.LEFT:n.pan(new THREE.Vector2(n.keyPanSpeed,0));t=true;break;case n.keys.RIGHT:n.pan(new THREE.Vector2(-n.keyPanSpeed,0));t=true;break}if(t){n.update()}}function L(e){if(n.enabled===false){return}switch(e.touches.length){case 1:if(n.noRotate===true){return}b=y.TOUCH_ROTATE;i.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(n.noZoom===true){return}b=y.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX;var r=e.touches[0].pageY-e.touches[1].pageY;var s=Math.sqrt(t*t+r*r);l.set(0,s);break;case 3:if(n.noPan===true){return}b=y.TOUCH_PAN;u.set(e.touches[0].pageX,e.touches[0].pageY);break;default:b=y.NONE}}function A(e){if(n.enabled===false){return}e.preventDefault();e.stopPropagation();var t=n.domElement===document?n.domElement.body:n.domElement;switch(e.touches.length){case 1:if(n.noRotate===true){return}if(b!==y.TOUCH_ROTATE){return}s.set(e.touches[0].pageX,e.touches[0].pageY);o.subVectors(s,i);n.rotateLeft(2*Math.PI*o.x/t.clientWidth*n.rotateSpeed);n.rotateUp(2*Math.PI*o.y/t.clientHeight*n.rotateSpeed);i.copy(s);break;case 2:if(n.noZoom===true){return}if(b!==y.TOUCH_DOLLY){return}var r=e.touches[0].pageX-e.touches[1].pageX;var p=e.touches[0].pageY-e.touches[1].pageY;var d=Math.sqrt(r*r+p*p);c.set(0,d);h.subVectors(c,l);if(h.y>0){n.dollyOut()}else{n.dollyIn()}l.copy(c);break;case 3:if(n.noPan===true){return}if(b!==y.TOUCH_PAN){return}a.set(e.touches[0].pageX,e.touches[0].pageY);f.subVectors(a,u);n.pan(f);u.copy(a);break;default:b=y.NONE}}function O(){if(n.enabled===false){return}b=y.NONE}this.object=e;this.domElement=t!==undefined?t:document;this.enabled=true;this.target=new THREE.Vector3;this.center=this.target;this.noZoom=false;this.zoomSpeed=1;this.minDistance=0;this.maxDistance=Infinity;this.noRotate=false;this.rotateSpeed=1;this.noPan=false;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.noKeys=false;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var n=this;var r=1e-6;var i=new THREE.Vector2;var s=new THREE.Vector2;var o=new THREE.Vector2;var u=new THREE.Vector2;var a=new THREE.Vector2;var f=new THREE.Vector2;var l=new THREE.Vector2;var c=new THREE.Vector2;var h=new THREE.Vector2;var p=0;var d=0;var v=1;var m=new THREE.Vector3;var g=new THREE.Vector3;var y={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5};var b=y.NONE;var w={type:"change"};this.rotateLeft=function(e){if(e===undefined){e=E()}d-=e};this.rotateUp=function(e){if(e===undefined){e=E()}p-=e};this.panLeft=function(e){var t=new THREE.Vector3;var n=this.object.matrix.elements;t.set(n[0],n[1],n[2]);t.multiplyScalar(-e);m.add(t)};this.panUp=function(e){var t=new THREE.Vector3;var n=this.object.matrix.elements;t.set(n[4],n[5],n[6]);t.multiplyScalar(e);m.add(t)};this.pan=function(e){var t=n.domElement===document?n.domElement.body:n.domElement;if(n.object.fov!==undefined){var r=n.object.position;var i=r.clone().sub(n.target);var s=i.length();s*=Math.tan(n.object.fov/2*Math.PI/180);n.panLeft(2*e.x*s/t.clientHeight);n.panUp(2*e.y*s/t.clientHeight)}else if(n.object.top!==undefined){n.panLeft(e.x*(n.object.right-n.object.left)/t.clientWidth);n.panUp(e.y*(n.object.top-n.object.bottom)/t.clientHeight)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")}};this.dollyIn=function(e){if(e===undefined){e=S()}v/=e};this.dollyOut=function(e){if(e===undefined){e=S()}v*=e};this.update=function(){var e=this.object.position;var t=e.clone().sub(this.target);var n=Math.atan2(t.x,t.z);var i=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);if(this.autoRotate){this.rotateLeft(E())}n+=d;i+=p;i=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,i));i=Math.max(r,Math.min(Math.PI-r,i));var s=t.length()*v;s=Math.max(this.minDistance,Math.min(this.maxDistance,s));this.target.add(m);t.x=s*Math.sin(i)*Math.sin(n);t.y=s*Math.cos(i);t.z=s*Math.sin(i)*Math.cos(n);e.copy(this.target).add(t);this.object.lookAt(this.target);d=0;p=0;v=1;m.set(0,0,0);if(g.distanceTo(this.object.position)>0){this.dispatchEvent(w);g.copy(this.object.position)}};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousedown",x,false);this.domElement.addEventListener("mousewheel",C,false);this.domElement.addEventListener("DOMMouseScroll",C,false);this.domElement.addEventListener("keydown",k,false);this.domElement.addEventListener("touchstart",L,false);this.domElement.addEventListener("touchend",O,false);this.domElement.addEventListener("touchmove",A,false)};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);var GSJS=function(e){function u(){t.scene.remove(t.faces);t.renderer.render(t.scene,t.camera);t.scene.add(t.faces);t.renderer.render(t.scene,t.camera)}function a(){t.controls.update();for(var e=0;e<t.points.children.length;e++)for(var n=0;n<t.points.children[e].children.length;n++)t.points.children[e].children[n].lookAt(t.camera.position);C();t.renderer.render(t.scene,t.camera)}function f(e){var n=t.container.width(),r=t.container.height();t.camera.aspect=n/r;t.camera.updateProjectionMatrix();t.renderer.setSize(n,r)}function c(e){l.x=(e.pageX-t.container.offset().left)/t.container.width()*2-1;l.y=-((e.pageY-t.container.offset().top)/t.container.height())*2+1;if(p&&!h)h=true}function d(e){p=true}function v(e){if(!h){if(e.button===2){C(true);if(T!==undefined)t.ShowContextMenu(T[0]);else t.ShowContextMenu()}else{for(var n=0;n<g.length;n++)g[n]()}}h=false;p=false}function m(e){C(true);if(T!==undefined)t.ShowEditMenu(T[0])}function b(e,t){t=t||{};if(y[e]!==undefined){t.type=e;for(var n=0;n<y[e].length;n++)y[e][n](t)}}function w(e){var t=document.createElement("canvas");var n=256;t.width=n;t.height=n;var r=t.getContext("2d");r.fillStyle="#ffffff";r.textAlign="center";r.font="128px Calibri";r.fillText(e,n/2,n/2);var i=new THREE.Texture(t);i.needsUpdate=true;var s=new THREE.SpriteMaterial({map:i,transparent:false,useScreenCoordinates:false,color:2236996,depthTest:false});var o=new THREE.Sprite(s);o.scale.set(24,24,1);return o}function E(e){t.points.remove(e);t.scene.remove(e.texte);if(e.figure)t.scene.remove(e.figure);delete e}function C(e){k();if(B==0&&!e||h)return false;var r=new THREE.Vector3(l.x,l.y,.5);if(n){var i=x.pickingRay(r,t.camera);var s=i.intersectObjects(t.scene.children,true)}else{x.unprojectVector(r,t.camera);S.set(t.camera.position,r.sub(t.camera.position).normalize());var s=S.intersectObjects(t.scene.children,true)}if(s.length>0){var o=new Array;for(var u=0;u<s.length;u++){if(s[u].object.parent.type=="point"){o.push(s[u]);break}}if(o==0){for(var u=0;u<s.length;u++){if(s[u].object.parent.type=="line")o.push(s[u])}if(o.length==0){o.push(s[0])}}T=new Array;var a=new Array,f=new Array;for(var u=0;u<o.length;u++){T[u]=o[u].object;if(T[u].parent.type=="point"){T[u]=T[u].parent;T[u].texte.material.color.setHex(52224);if(T[u].figure)T[u].figure.material.color.setHex(52224);f.push(T[u])}else{T[u].material.color.setHex(52224);if(T[u].material instanceof THREE.LineDashedMaterial)a.push(T[u])}}if(f.length==0){if(a.length>1){var c=t.intersectionLines(a[0].geometry.vertices[0],a[0].geometry.vertices[1],a[1].geometry.vertices[0],a[1].geometry.vertices[1]);if(c){N=c}else{N=o[0].point}}else{N=o[0].point}}else{N=f[0].children[0].position}}}function k(){if(T!==undefined){for(var e=0;e<T.length;e++){if(T[e].type=="point"){T[e].texte.material.color.setHex(2236996);if(T[e].figure)T[e].figure.material.color.setHex(2236996)}else if(T[e].type=="face"){T[e].material.color.setHex(T[e].initialColor||15790320)}else{T[e].material.color.setHex(T[e].parent.initialColor||13369344)}}T=undefined}}function j(e,n){var r=B;t.Interface.ResetControls();if(r!=e){for(var i=0;i<n.length;i++)n[i].addClass("active");B=e;return true}else{return false}}function F(e){if(T!==undefined){t.Interface.ResetControls();t.createPoint(N,"T")}}function q(e){if(T!==undefined){t.removeMouseDownEvent(q);t.addMouseDownEvent(R);I=N}}function R(e){if(T!==undefined){t.Interface.ResetControls();t.createDroite(I,N)}}function z(e){if(T!==undefined){t.removeMouseDownEvent(z);t.addMouseDownEvent(W);U=N}}function W(e){if(T!==undefined){t.Interface.ResetControls();t.createSegment(U,N)}}var t=this;if(e===undefined)e={};this.container=e.container;var n=e.ortho||false;var r=e.debug||false;var i=e.autoRun||false;if(e.container&&e.container instanceof jQuery===false)this.container=$(e.container);if(!e.container){this.container=$("<div></div>");$("body").append(this.container)}this.container.css("padding",0);if(this.container.css("position")=="static")this.container.css("position","relative");if(e.useWebGL!==false&&Detector.webgl)this.useWebGL=true;else this.useWebGL=false;var s=t.container.width(),o=t.container.height();if(n)t.camera=new THREE.OrthographicCamera(s/-2,s/2,o/2,o/-2,1,1e3);else t.camera=new THREE.PerspectiveCamera(70,s/o,1,1e3);t.camera.position.z=400;t.scene=new THREE.Scene;t.points=new THREE.Object3D;t.lines=new THREE.Object3D;t.faces=new THREE.Object3D;t.scene.add(t.points);t.scene.add(t.lines);t.scene.add(t.faces);if(t.useWebGL)t.renderer=new THREE.WebGLRenderer({antialias:true});else t.renderer=new THREE.CanvasRenderer;t.renderer.setSize(s,o);t.renderer.setClearColor(14869218,1);t.container.append(t.renderer.domElement);t.controls=new THREE.OrbitControls(t.camera,t.renderer.domElement);if(r){t.stats=new Stats;t.stats.domElement.style.position="absolute";t.stats.domElement.style.top="0px";t.container.append(t.stats.domElement)}this.animate=function(){requestAnimationFrame(t.animate);a();if(r)t.stats.update()};this.loadObject=function(e){var n=[];for(var r=0;r<e.vertex.length;r++)n.push((new THREE.Vector3(e.vertex[r][0],e.vertex[r][1],e.vertex[r][2])).multiplyScalar(.9));for(var r=0;r<e.edges.length;r++)t.createSegment(n[e.edges[r][0]],n[e.edges[r][1]],13369344);if(e.names!==undefined){for(var r=0;r<e.names.length;r++){if(e.names[r])t.createPoint(n[r],e.names[r],0)}}for(var i=0;i<e.faces.length;i++){var s=new THREE.Geometry;var o=0;var u=new THREE.MeshBasicMaterial({color:15790320,vertexColors:THREE.FaceColors,side:THREE.DoubleSide});for(var r=0;r<e.faces[i].length;r++)s.vertices[r]=n[e.faces[i][r]].clone().multiplyScalar(.996);for(var r=0;r<e.faces[i].length-2;r++){s.faces[o]=new THREE.Face3(0,r+1,r+2);s.faces[o].color=new THREE.Color(15790320);o++}s.computeFaceNormals();s.computeVertexNormals();var a=new THREE.Mesh(s,u);a.type="face";t.faces.add(a)}return t};t.container.bind("mousemove",c);t.renderer.domElement.addEventListener("mousedown",d,false);t.renderer.domElement.addEventListener("mouseup",v,false);$(t.renderer.domElement).dblclick(m);$(window).resize(f);var l=new THREE.Vector2;var h=false;var p=false;var g=new Array;t.addMouseDownEvent=function(e){if(g.indexOf(e)===-1)g.push(e)};t.removeMouseDownEvent=function(e){if(g.indexOf(e)!==-1)g.splice(e,1)};var y=new Array;t.bind=function(e,n){if(y[e]===undefined)y[e]=new Array;if(y[e].indexOf(n)===-1)y[e].push(n);return t};t.unbind=function(e,n){if(y[e]!==undefined){if(y[e].indexOf(n)!==-1)y[e].splice(n,1)}return t};this.createPoint=function(e,n,r,i){if(e instanceof THREE.Vector3===false)e=new THREE.Vector3(e.x||e[0],e.y||e[1],e.z||e[2]);if(r===undefined||r>1)r=1;if(i===undefined)i=true;var s=new THREE.Object3D;s.nom=n;s.type="point";s.editable=i;var o=new THREE.PlaneGeometry(6,6);var u=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,visible:false});var a=new THREE.Mesh(o,u);a.position.copy(e);s.add(a);var a=new THREE.Mesh(o,u);a.scale.multiplyScalar(2);a.position.copy(e).add({x:5,y:10,z:5});s.add(a);var f=w(n);f.position.copy(e).addScalar(5);t.scene.add(f);s.texte=f;if(r!==0){var l=document.createElement("canvas");var c=256;l.width=c;l.height=c;var h=l.getContext("2d");h.beginPath();h.lineWidth=8;h.moveTo(0,0);h.lineTo(256,256);h.moveTo(0,256);h.lineTo(256,0);h.strokeStyle="#ffffff";h.stroke();var p=new THREE.Texture(l);p.needsUpdate=true;var d=new THREE.SpriteMaterial({map:p,transparent:false,useScreenCoordinates:false,color:2236996,depthTest:false});var v=new THREE.Sprite(d);v.scale.set(5,5,1);v.position.copy(e);t.scene.add(v);s.figure=v}t.points.add(s);b("createPoint",{name:n,x:e.x,y:e.y,z:e.z});return t};this.deletePoint=function(e){var n=undefined;if(typeof e==="string"){for(var r=0;r<t.points.children.length;r++){if(t.points.children[r].nom==e&&t.points.children[r].editable!==false){E(t.points.children[r]);n=e;break}}}else if(typeof e==="object"&&e.type=="point"&&e.editable!==false){if(t.points.children.indexOf(e)!==-1){n=e.nom;E(e)}}if(n!==undefined){b("deletePoint",{name:n})}return t};this.getPointByName=function(e){var n={};for(var r=0;r<t.points.children.length;r++){if(t.points.children[r].nom==e){var i=t.points.children[r].children[0];n.x=i.position.x;n.y=i.position.y;n.z=i.position.z;n.name=i.parent.nom;return n}}return null};this.getPointByPosition=function(e,n){if(e instanceof THREE.Vector3===false)e=new THREE.Vector3(e.x||e[0],e.y||e[1],e.z||e[2]);if(n===undefined)n=1;var r={};for(var i=0;i<t.points.children.length;i++){var s=t.points.children[i].children[0],o=e.distanceTo(s.position);if(o<n&&(!r.distance||r.distance>o)){r.distance=o;r.obj=s}}if(r.obj){var u={};u.x=r.obj.position.x;u.y=r.obj.position.y;u.z=r.obj.position.z;u.name=r.obj.parent.nom;return u}return null};this.createDroite=function(e,n,r){if(e instanceof THREE.Vector3===false)var e=new THREE.Vector3(e.x||e[0],e.y||e[1],e.z||e[2]);if(!n instanceof THREE.Vector3===false)var n=new THREE.Vector3(n.x||n[0],n.y||n[1],n.z||n[2]);r=r||204;var i=2e3;var s=e.distanceTo(n);var o=new THREE.Vector3;var u=new THREE.Vector3;o.subVectors(n,e).multiplyScalar(i/s).add(e);u.subVectors(e,n).multiplyScalar(i/s).add(n);b("createDroite",{color:r});return t.createSegment(u,o,r,false)};this.createDemiDroite=function(e,n,r){if(e instanceof THREE.Vector3===false)e=new THREE.Vector3(e.x||e[0],e.y||e[1],e.z||e[2]);if(!n instanceof THREE.Vector3===false)n=new THREE.Vector3(n.x||n[0],n.y||n[1],n.z||n[2]);r=r||204;var i=1e3;var s=e.distanceTo(n);var o=new THREE.Vector3;o.subVectors(n,e).multiplyScalar(i/s).add(e);b("createDemiDroite",{color:r});return t.createSegment(e,o,r,false)};this.createSegment=function(e,n,r,i){if(e instanceof THREE.Vector3===false)var e=new THREE.Vector3(e.x||e[0],e.y||e[1],e.z||e[2]);if(n instanceof THREE.Vector3===false)var n=new THREE.Vector3(n.x||n[0],n.y||n[1],n.z||n[2]);r=r||2991515;if(i===undefined)i=true;var s=new THREE.Geometry;s.vertices.push(e,n);s.computeLineDistances();var o=new THREE.Object3D;o.add(new THREE.Line(s,new THREE.LineBasicMaterial({color:r})));o.add(new THREE.Line(s,new THREE.LineDashedMaterial({color:r,dashSize:15,gapSize:10,depthTest:false})));o.type="line";o.initialColor=r;t.scene.add(o);u();if(i){b("createSegment",{color:r})}return t};this.intersectionLines=function(e,t,n,r){if(e instanceof THREE.Vector3===false)var e=new THREE.Vector3(e.x||e[0],e.y||e[1],e.z||e[2]);if(t instanceof THREE.Vector3===false)var t=new THREE.Vector3(t.x||t[0],t.y||t[1],t.z||t[2]);if(n instanceof THREE.Vector3===false)var n=new THREE.Vector3(n.x||n[0],n.y||n[1],n.z||n[2]);if(r instanceof THREE.Vector3===false)var r=new THREE.Vector3(r.x||r[0],r.y||r[1],r.z||r[2]);try{var i=(e.x*t.y-e.x*n.y-t.x*e.y+t.x*n.y+n.x*e.y-n.x*t.y)/(-e.x*n.y+e.x*r.y+t.x*n.y-t.x*r.y+n.x*e.y-n.x*t.y-r.x*e.y+r.x*t.y);var s=(n.x+i*(r.x-n.x)-e.x)/(t.x-e.x);if(e.z+s*(t.z-e.z)==n.z+i*(r.z-n.z))return new THREE.Vector3(e.x+s*(t.x-e.x),e.y+s*(t.y-e.y),e.z+s*(t.z-e.z));else return null}catch(o){return null}};var S=new THREE.Raycaster;var x=new THREE.Projector;var T=undefined;var N;var L=$('<div id="GSJSContextMenu"></div>');L.hide();$(t.container).append(L);$(document).bind("mousedown",function(){if(!$("#GSJSContextMenu:hover").length>0)t.HideContextMenu()});var A=$('<div id="GSJSEditMenu"><div class="name"><div><label>Nom</label><input></div></div><div class="delete"><div>Supprimer cette objet</div></div><div class="ok"><div>Fermer</div></div></div>');A.hide();$(t.container).append(A);var O=false;var M=undefined;t.ShowContextMenu=function(e){if(!t.ContextMenuActive)return;if(e!==undefined&&e.editable!==false){M=e;L.find(".onlyIfObject").show()}else{L.find(".onlyIfObject").hide()}L.css({left:(l.x+1)/2*t.container.width()+1+"px",top:t.container.height()-(l.y+1)/2*t.container.height()+1+"px"}).fadeIn("fast");O=true;return t};t.HideContextMenu=function(){if(!O)return;M=undefined;L.hide();O=false;return t};t.addToContextMenu=function(e,n,r){r=r||false;var i=$("<div"+(r?' class="onlyIfObject"':"")+">"+e+"</div>");i.click(function(){n(M)});i.click(function(){t.HideContextMenu()});L.prepend(i);return t};t.ContextMenuActive=true;t.addToContextMenu("Supprimer l'objet",function(e){t.deletePoint(e)},true);t.addToContextMenu("Options de l'objet",function(e){t.ShowEditMenu(e)},true);var _=false;var D=undefined;t.ShowEditMenu=function(e){if(e===undefined||e.editable===false)return t;D=e;P=e.nom||"";A.find(".name input").val(P);A.fadeIn();_=true;return t};t.HideEditMenu=function(){if(!_)return t;D=undefined;A.fadeOut();_=false;return t};$("#GSJSEditMenu .ok").click(function(){t.HideEditMenu()});var P;$("#GSJSEditMenu .name input").bind("propertychange keyup input paste",function(e){if(!D||!D.texte||P==$(this).val())return false;if($(this).val()&&!/^[a-zA-Z][0-9₀₁₂₃₄₅₆₇₈₉]{0,3}$/.test($(this).val())){$(this).val(P);return false}$(this).val($(this).val().toUpperCase());var t=["₀","₁","₂","₃","₄","₅","₆","₇","₈","₉"];for(var n=0;n<t.length;n++)$(this).val($(this).val().replace(n,t[n]));P=$(this).val();D.texte.material=w(P).material;D.nom=P});$("#GSJSEditMenu .delete").click(function(){t.deletePoint(D)});t.bind("deletePoint",function(e){if($("#GSJSEditMenu .name input").val()===e.name)t.HideEditMenu()});var H={addPoint:new Array,addDroite:new Array,addSegment:new Array};var B=0;t.Interface={};t.Interface.addDefaultInterface=function(){var e=$('<div id="GSJSDefaultInterface"></div>');var n=["addPoint","addDroite","addSegment"];var r=["Ajouter un point","Ajouter une droite","Ajouter un segment"];for(var i=0;i<n.length;i++){var s=$('<div class="'+n[i]+'" title="'+r[i]+'"></div>');t.Interface.addControlButton(n[i],s);e.append(s)}t.container.append(e);return t.Interface};t.Interface.addControlButton=function(e,n){if(n instanceof jQuery===false)n=$(n);switch(e){case"addPoint":n.click(t.Interface.TriggerAddPoint);if(H.addPoint.indexOf(n)===-1)H.addPoint.push(n);break;case"addDroite":n.click(t.Interface.TriggerAddDroite);if(H.addDroite.indexOf(n)===-1)H.addDroite.push(n);break;case"addSegment":n.click(t.Interface.TriggerAddSegment);if(H.addSegment.indexOf(n)===-1)H.addSegment.push(n);break;default:console.warn('J3D.Interface.addControlButton(): "'+e+'" est un type inconnu.')}return t.Interface};t.Interface.removeControlButton=function(e,n){if(n instanceof jQuery===false)n=$(n);switch(e){case"addPoint":n.off("click",t.Interface.TriggerAddPoint);if(H.addPoint.indexOf(n)!==-1)H.addPoint.splice(n,1);break;case"addDroite":n.off("click",t.Interface.TriggerAddDroite);if(H.addDroite.indexOf(n)!==-1)H.addDroite.splice(n,1);break;case"addSegment":n.off("click",t.Interface.TriggerAddSegment);if(H.addSegment.indexOf(n)!==-1)H.addSegment.splice(n,1);break;default:console.warn('J3D.Interface.removeControlButton(): "'+e+'" est un type inconnu.')}return t.Interface};t.Interface.TriggerAddPoint=function(){var e=false;if(j(1,H.addPoint)){t.addMouseDownEvent(F);e=true}b("TriggerAddPoint",{active:e});return t.Interface};t.Interface.TriggerAddDroite=function(){var e=false;if(j(2,H.addDroite)){t.addMouseDownEvent(q);e=true}b("TriggerAddDroite",{active:e});return t.Interface};t.Interface.TriggerAddSegment=function(){var e=false;if(j(3,H.addSegment)){t.addMouseDownEvent(z);e=true}b("TriggerAddSegment",{active:e});return t.Interface};t.Interface.ResetControls=function(e){if(e!==false){t.removeMouseDownEvent(F);t.removeMouseDownEvent(q);t.removeMouseDownEvent(R);t.removeMouseDownEvent(z);t.removeMouseDownEvent(W)}for(index in H){for(var n=0;n<H[index].length;n++)H[index][n].removeClass("active")}B=0;return t.Interface};var I;var U;t.animate()}
