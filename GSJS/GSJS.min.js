var GSJS=function(e){function s(){if(t.ortho)t.camera=new THREE.OrthographicCamera(t.container.offsetWidth/-2,t.container.offsetWidth/2,t.container.offsetHeight/2,t.container.offsetHeight/-2,1,1e3);else t.camera=new THREE.PerspectiveCamera(70,t.container.offsetWidth/t.container.offsetHeight,1,1e3);t.camera.position.z=400;t.scene=new THREE.Scene;t.points=new THREE.Object3D;t.lines=new THREE.Object3D;t.faces=new THREE.Object3D;t.scene.add(t.points);t.scene.add(t.lines);t.scene.add(t.faces);if(t.useWebGL)t.renderer=new THREE.WebGLRenderer({antialias:true});else t.renderer=new THREE.CanvasRenderer;t.renderer.setSize(t.container.offsetWidth,t.container.offsetHeight);t.renderer.setClearColor(14869218,1);t.container.appendChild(t.renderer.domElement);t.controls=new THREE.OrbitControls(t.camera,t.renderer.domElement);if(t.debug){t.stats=new Stats;t.stats.domElement.style.position="absolute";t.stats.domElement.style.top="0px";t.container.appendChild(t.stats.domElement)}if(n)t.animate();return true}function o(e){var t=document.createElement("canvas");var n=256;t.width=n;t.height=n;var r=t.getContext("2d");r.fillStyle="#222244";r.textAlign="center";r.font="128px Arial";r.fillText(e,n/2,n/2);var i=new THREE.Texture(t);i.needsUpdate=true;var s=new THREE.SpriteMaterial({map:i,transparent:false,useScreenCoordinates:false,color:16777215,depthTest:false});var o=new THREE.Sprite(s);o.scale.set(24,24,1);return o}function u(){t.scene.remove(t.faces);t.renderer.render(t.scene,t.camera);t.scene.add(t.faces);t.renderer.render(t.scene,t.camera)}function a(){t.controls.update();y();t.renderer.render(t.scene,t.camera)}function f(){t.camera.aspect=t.container.offsetWidth/t.container.offsetHeight;t.camera.updateProjectionMatrix();t.renderer.setSize(t.container.offsetWidth,t.container.offsetHeight)}function c(e){l.x=(e.pageX-t.container.offsetLeft)/t.container.offsetWidth*2-1;l.y=-((e.pageY-t.container.offsetTop)/t.container.offsetHeight)*2+1}function p(e){h=l.clone()}function d(e){if(h.x==l.x&&h.y==l.y){if(e.button===2){y(true);if(r!==undefined)t.ShowContextMenu(r[0]);else t.ShowContextMenu()}else{for(var n=0;n<v.length;n++)v[n]()}}}function y(e){b();if(k==0&&!e)return false;var n=new THREE.Vector3(l.x,l.y,.5);if(t.ortho){var s=g.pickingRay(n,t.camera);var o=s.intersectObjects(t.scene.children,true)}else{g.unprojectVector(n,t.camera);m.set(t.camera.position,n.sub(t.camera.position).normalize());var o=m.intersectObjects(t.scene.children,true)}if(o.length>0){var u=new Array;for(var a=0;a<o.length;a++){if(o[a].object.parent.type=="line"||o[a].object.type=="point")u.push(o[a])}if(u.length==0){u.push(o[0])}r=new Array;var f=new Array,c=new Array;for(var a=0;a<u.length;a++){r[a]=u[a].object;if(r[a].type=="point"){r[a].material.emissive.setHex(52224);c.push(r[a])}else{r[a].material.color.setHex(52224);if(r[a].material instanceof THREE.LineDashedMaterial)f.push(r[a])}}if(c.length==0){if(f.length>1){var s=new THREE.Raycaster;s.set(f[0].geometry.vertices[0],f[0].geometry.vertices[1].clone().normalize());var h=m.intersectObject(f[1]);if(h.length==1){i=h[0].point}else{i=u[0].point}}else{i=u[0].point}}else{i=c[0].position}}}function b(){if(r!==undefined){for(var e=0;e<r.length;e++){if(r[e].type=="point")r[e].material.emissive.setHex(r[e].initialColor||2236996);else if(r[e].type=="face")r[e].material.color.setHex(r[e].initialColor||15790320);else r[e].material.color.setHex(r[e].parent.initialColor||13369344)}r=undefined}}function L(e,n){var r=k;t.Interface.ResetControls();if(r!=e){for(var i=0;i<n.length;i++)n[i].addClass("active");k=e;return true}else{return false}}function A(e){if(r!==undefined){t.Interface.ResetControls();t.createPoint(i,"T")}}function M(e){if(r!==undefined){t.removeMouseDownEvent(M);t.addMouseDownEvent(_);O=i}}function _(e){if(r!==undefined){t.Interface.ResetControls();t.createDroite(O,i)}}function P(e){if(r!==undefined){t.removeMouseDownEvent(P);t.addMouseDownEvent(H);D=i}}function H(e){if(r!==undefined){t.Interface.ResetControls();t.createSegment(D,i)}}var t=this;if(e===undefined)e={};this.container=e.container;this.ortho=e.ortho||false;this.debug=e.debug||false;var n=e.autoRun||false;if(!e.container){this.container=document.createElement("div");$("body").append(this.container)}this.container.style.padding=0;if(this.container.style.position=="static"||!this.container.style.position)this.container.style.position="relative";if(e.useWebGL!==false&&Detector.webgl)this.useWebGL=true;else this.useWebGL=false;var r=undefined;var i;s();this.run=function(){if(!n){n=true;t.animate()}return t};this.animate=function(){requestAnimationFrame(t.animate);a();if(t.debug)t.stats.update()};this.loadObject=function(e){var n=[];for(var r=0;r<e.vertex.length;r++)n.push((new THREE.Vector3(e.vertex[r][0],e.vertex[r][1],e.vertex[r][2])).multiplyScalar(.9));for(var r=0;r<e.edges.length;r++)t.createSegment(n[e.edges[r][0]],n[e.edges[r][1]],13369344);if(e.names!==undefined){for(var r=0;r<e.names.length;r++){if(e.names[r])t.createPoint(n[r],e.names[r],false)}}for(var i=0;i<e.faces.length;i++){var s=new THREE.Geometry;var o=0;var u=new THREE.MeshBasicMaterial({color:15790320,vertexColors:THREE.FaceColors,side:THREE.DoubleSide});for(var r=0;r<e.faces[i].length;r++)s.vertices[r]=n[e.faces[i][r]].clone().multiplyScalar(.996);for(var r=0;r<e.faces[i].length-2;r++){s.faces[o]=new THREE.Face3(0,r+1,r+2);s.faces[o].color=new THREE.Color(15790320);o++}s.computeFaceNormals();s.computeVertexNormals();var a=new THREE.Mesh(s,u);a.type="face";t.faces.add(a)}return t};this.createPoint=function(e,n,r){if(!e instanceof THREE.Vector3)e=new THREE.Vector3(e.x,e.y,e.z);if(r===undefined)r=true;var i=o(n);if(r){var s=new THREE.Mesh(new THREE.SphereGeometry(3,12,12),new THREE.MeshBasicMaterial({color:2236996,depthTest:false}));s.position.copy(e);s.nom="T";s.texte=i;t.points.add(s);var s=new THREE.Mesh(new THREE.SphereGeometry(3,12,12),new THREE.MeshBasicMaterial({color:2236996}));s.position.copy(e);s.nom="T";s.texte=i;t.points.add(s)}i.position.copy(e).multiplyScalar(1.06);t.points.add(i);return t};this.createDroite=function(e,n,r){if(e instanceof THREE.Vector3===false)var e=new THREE.Vector3(e.x,e.y,e.z);if(!n instanceof THREE.Vector3===false)var n=new THREE.Vector3(n.x,n.y,n.z);r=r||204;const i=2e3;var s=e.distanceTo(n);var o=new THREE.Vector3;var u=new THREE.Vector3;o.subVectors(n,e).multiplyScalar(i/s).add(e);u.subVectors(e,n).multiplyScalar(i/s).add(n);return t.createSegment(u,o,r)};this.createDemiDroite=function(e,n,r){if(e instanceof THREE.Vector3===false)e=new THREE.Vector3(e.x,e.y,e.z);if(!n instanceof THREE.Vector3===false)n=new THREE.Vector3(n.x,n.y,n.z);r=r||204;const i=1e3;var s=e.distanceTo(n);var o=new THREE.Vector3;o.subVectors(n,e).multiplyScalar(i/s).add(e);return t.createSegment(e,o,r)};this.createSegment=function(e,n,r){if(e instanceof THREE.Vector3===false)var e=new THREE.Vector3(e.x,e.y,e.z);if(n instanceof THREE.Vector3===false)var n=new THREE.Vector3(n.x,n.y,n.z);r=r||2991515;var i=new THREE.Geometry;i.vertices.push(e,n);i.computeLineDistances();var s=new THREE.Object3D;s.add(new THREE.Line(i,new THREE.LineBasicMaterial({color:r})));s.add(new THREE.Line(i,new THREE.LineDashedMaterial({color:r,dashSize:15,gapSize:10,depthTest:false})));s.type="line";s.initialColor=r;t.scene.add(s);u();return t};t.container.addEventListener("mousemove",c,false);t.renderer.domElement.addEventListener("mousedown",p,false);t.renderer.domElement.addEventListener("mouseup",d,false);window.addEventListener("resize",f,false);var l=new THREE.Vector2;var h;var v=new Array;t.addMouseDownEvent=function(e){if(v.indexOf(e)===-1)v.push(e)};t.removeMouseDownEvent=function(e){if(v.indexOf(e)!==-1)v.splice(e,1)};var m=new THREE.Raycaster;var g=new THREE.Projector;$("head").append('<style type="text/css">#GSJSContextMenu{position:absolute;width:200px;background:#BABACF;box-shadow:2px 2px 4px #797979}#GSJSContextMenu>div{height:30px;padding:0 20px;font:16px Arial;transition:background .3s;cursor:default;color:#4B4545;line-height:30px}#GSJSContextMenu>div:hover{background:#A3A3BB}#GSJSEditMenu{position:absolute;top:0;right:0}#GSJSEditMenu>div{height:25px;padding:5px;width:250px;background:#635D6E;font:17px Arial;color:#F5F5F5;line-height:25px;border-bottom:2px solid #3F3F3F}#GSJSEditMenu label{font:17px Arial;color:#F5F5F5;line-height:25px}#GSJSEditMenu input{background:#9492A0;border:0;height:25px;float:right;padding:0 10px;width:140px;font:18px Arial;color:#007E00}#GSJSEditMenu .ok{height:19px;text-align:center;padding:0 5px;font-size:13px;line-height:19px;border-bottom:0;cursor:pointer;transition: background .4s}#GSJSEditMenu .ok:hover{background: #746499}</style>');var w=$('<div id="GSJSContextMenu"></div>');w.hide();$(t.container).append(w);$(document).bind("mousedown",function(){if(!$("#GSJSContextMenu:hover").length>0)t.HideContextMenu()});var E=$('<div id="GSJSEditMenu"><div class="name"><label>Nom</label><input></div><div class="ok">Fermer</div></div>');E.hide();$(t.container).append(E);var S=false;var x=undefined;t.ShowContextMenu=function(e){if(!t.ContextMenuActive)return;if(e!==undefined){x=e;w.find(".onlyIfObject").show()}else{w.find(".onlyIfObject").hide()}w.css({left:(l.x+1)/2*t.container.offsetWidth+1+"px",top:$(t.container).height()-(l.y+1)/2*$(t.container).height()+1+"px"}).fadeIn("fast");S=true;return t};t.HideContextMenu=function(){if(!S)return;x=undefined;w.hide();S=false;return t};t.addToContextMenu=function(e,n,r){r=r||false;var i=$("<div"+(r?' class="onlyIfObject"':"")+">"+e+"</div>");i.click(n);i.click(function(){t.HideContextMenu()});w.prepend(i);return t};t.ContextMenuActive=true;t.addToContextMenu("A Propos",function(){alert("(c) Parks Projet")});t.addToContextMenu("Param√®tres",function(){});t.addToContextMenu("Options de l'objet",function(){t.ShowEditMenu(x)},true);var T=false;var N=undefined;t.ShowEditMenu=function(e){if(e===undefined)return t;N=e;E.find(".name input").val(e.nom||"");E.fadeIn();T=true;console.log(e);return t};t.HideEditMenu=function(){if(!T)return t;N=undefined;E.fadeOut();T=false;return t};$("#GSJSEditMenu .ok").click(function(){t.HideEditMenu()});$("#GSJSEditMenu .name").bind("propertychange keyup input paste",function(){if(!N||!N.texte)return;N.texte.material=o($(this).val()).material});var C={addPoint:new Array,addDroite:new Array,addSegment:new Array};var k=0;t.Interface={};t.Interface.addDefaultInterface=function(){$("head").append('<style type="text/css">#J3DDefaultInterface{position:absolute;bottom:15px;right:15px}#J3DDefaultInterface>div{height:50px;width:50px;border:2px solid #9C9C9C;border-radius:7px;background:#fff;float:left;margin-left:12px;cursor:pointer;transition:border-color .4s,background .5s}#J3DDefaultInterface>div:hover{border-color:#7F74CC}#J3DDefaultInterface>div.active{background:#aecfff;border-color:#7F74CC}</style>');var e=document.createElement("div");e.id="J3DDefaultInterface";var n=["addPoint","addDroite","addSegment"];var r=["Ajouter un point","Ajouter une droite","Ajouter un segment"];for(var i=0;i<n.length;i++){var s=document.createElement("div");s.id=n[i];s.title=r[i];t.Interface.addControlButton(n[i],s);e.appendChild(s)}t.container.appendChild(e);return t.Interface};t.Interface.addControlButton=function(e,n){if(n instanceof jQuery===false)n=$(n);switch(e){case"addPoint":n.click(t.Interface.ToggleAddPoint);C.addPoint.push(n);break;case"addDroite":n.click(t.Interface.ToggleAddDroite);C.addDroite.push(n);break;case"addSegment":n.click(t.Interface.ToggleAddSegment);C.addSegment.push(n);break;default:console.warn('J3D.Interface.addControlButton: "'+e+'" est un controle inconnu.')}return t.Interface};t.Interface.removeControlButton=function(e,n){if(n instanceof jQuery===false)n=$(n);switch(e){case"addPoint":n.off("click",t.Interface.ToggleAddPoint);C.addPoint.splice(n,1);break;case"addDroite":n.off("click",t.Interface.ToggleAddDroite);C.addDroite.splice(n,1);break;case"addSegment":n.off("click",t.Interface.ToggleAddSegment);C.addSegment.splice(n,1);break;default:console.warn('J3D.Interface.addControlButton: "'+e+'" est un controle inconnu.')}return t.Interface};t.Interface.ToggleAddPoint=function(){if(L(1,C.addPoint))t.addMouseDownEvent(A);return t.Interface};t.Interface.ToggleAddDroite=function(){if(L(2,C.addDroite))t.addMouseDownEvent(M);return t.Interface};t.Interface.ToggleAddSegment=function(){if(L(3,C.addSegment))t.addMouseDownEvent(P);return t.Interface};t.Interface.ResetControls=function(e){if(e!==false){t.removeMouseDownEvent(A);t.removeMouseDownEvent(M);t.removeMouseDownEvent(_);t.removeMouseDownEvent(P);t.removeMouseDownEvent(H)}for(index in C){for(var n=0;n<C[index].length;n++)C[index][n].removeClass("active")}k=0;return t.Interface};var O;var D}
